
@using SocialApps.Models

<script type="text/javascript">
	@*	Constructing array of data which are used to build graphs.
		Variable must have the same name as on other pages. *@
	var imageURL = [];
</script>

<div class="tab-content">
	@{
		var currencyGroups = (CurrencyGroup[])ViewBag.CurrencyGroups;

		for (var i = 0; i < currencyGroups.Count(); i++)
		{
			var tabClass = (i == 0) ? "tab-pane fade in active" : "tab-pane fade";
			var diagramId = "diagram_" + currencyGroups[i].GroupId.ToString();
			var diagramContainerId = "diagram_container_" + currencyGroups[i].GroupId.ToString();
			@* Identifier of the outer container. *@
			var chartTabId = ViewBag.TabPrefix + currencyGroups[i].GroupId.ToString();

			<div class="@Html.Raw(tabClass)" id="@Html.Raw(chartTabId)" style="margin-top: 8px;">
				<div style="display: inline-block; margin-top: 8px;">
					<div class="panel-body" id="@Html.Raw(diagramContainerId)">
						<img id="@Html.Raw(diagramId)" src="" alt="@Html.Raw(ViewBag.Title)" onload="updateParentHeight();" />
					</div>
				</div>
				<div class="panel-body">
					<table>
						<tbody>
							<tr>
								<td>
									<script>
										imageURL.push({
											pie: true,
											url: '@Url.Action(ViewBag.ChartActionName, "Mobile", new { currencyGroupId = currencyGroups[i].GroupId, timestamp = DateTime.Now.Ticks })',
											diagramId: '@Html.Raw(diagramId)',
											diagramContainerId: '@Html.Raw(diagramContainerId)'
										});
									</script>
									<div class="btn-group">
										@* Timestamp parameter is added to overcome image caching. *@
										<button type="button" class="btn btn-default" onclick="updateDiagramURL(false, '@Url.Action(ViewBag.ChartActionName, "Mobile", new { currencyGroupId = currencyGroups[i].GroupId, timestamp = DateTime.Now.Ticks })', '@Html.Raw(diagramId)', '@Html.Raw(diagramContainerId)');">
											@Html.Raw(Resources.Resources.Bar)
										</button>
										<button type="button" class="btn btn-default" onclick="updateDiagramURL(true, '@Url.Action(ViewBag.ChartActionName, "Mobile", new { currencyGroupId = currencyGroups[i].GroupId, timestamp = DateTime.Now.Ticks })', '@Html.Raw(diagramId)', '@Html.Raw(diagramContainerId)');">
											@Html.Raw(Resources.Resources.Pie)
										</button>
									</div>
								</td>
								<td></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		}
	}
</div>
